# AZ対策セミナー Day2

## Azureのセキュリティの保護

### 境界防行だけではだめ

- クラウドはWFの外側にある。
- 多層防御
- ゼロトラスト
  - あらゆるリソースがネットワークに露出した状態で設計。
- 共有責任

### Azure Firewall

- WAF

### Azure DDoS保護

- 規定で有効。使わないという選択はない。
- 無償サービス。
- レポーティング情報の提供はStandardレベルが必要で有償。

### Netwart Security Group(NSG)

- 仮想ネットワークや仮想マシンのセキュリティ制御を行う機能。
- 小さいWFというイメージ。アクセス元と
- 3389: リモートディスクトッププロトコル。
- ソースを任意にする場合は危険性を考慮する必要がある。
- NICまたはサブネットにNSGのルールを紐づけることができる。
  - 同じルールは1つだけ作り色々な部分に紐づける。

### Application Security Group

- リソースをグルーピングしてNSGに紐づけることができる。

### Azureでのセキュリティソリューションの選択

- DMZではAzure DDoSとAzure Firewall
- ネットワーク層ではNSG

## 認証

### 認証と認可

- 認証サーバと認可サーバは分離するのが望ましい。
- 認証
  - デバイス、ユーザなどを特定、識別する。
- 認可(承認)
  - 認証した人に対してアクセス権を与える。

### AzureAD

- IDaaS
- クラウドベースのID及びアクセス管理。
- 結果的にシングルサインオンとなる。(SSO)
- 全てのデバイス、リソースに対して認証・認可できる。
- ユーザ、デバイス、アプリケーションを認可する。
- オンプレのWSADとIdentity Federationできる。
- 資格情報を受け取り正しければトークン(Claim: ユーザの属性, Signetuar: 証明)を発行する。

### Azure AD B2B

- 他者のADのユーザを自社のADに招待して自社のAPPへのアクセス権を与える。

### Azure AD B2C

- フロントに様々なSNSのIDを繋げることができる。ADではなくSNSのIDで認証することができる。

### Multi Factor Authentication (MFA)

- 以下の情報のうち2つ以上の要素を必要とする
  - ユーザが知っているもの
  - ユーザが持っているもの
  - ユーザ自身

### Azure Security Center

- Azureとオンプレミスのセキュリティ診断を行える。
- Azure Adviserは無償版なのでASCの一部機能を流用している。
- 規制コンプライアンスへの適合率チェックは有償版でのみ提供。

### Azure Key Vault

- キーを保管しておく金庫
- シークレット(DB接続文字列)、キー、証明書の管理などに用いられる。
- DB接続文字列をKeyVaultに保管しAPPからライブラリで取得するような設計にすることで開発者が接続文字列を知る必要がなくなる。

### Azure Infomation Protection

- 暗号化してアクセスコントロールする。
- 権限を定義することができる。
- 自動ラベリング機能が存在している。

### Azure Advanced Threat Protection

- 脅威を検出して調査する。
- インストールは必要。

## ガバナンスの方法論

### Azure Policy

- Azure内のリソースに適応することのできるポリシー
- ポリシーの例
  1. ユーザに作成できるストレージサイズの設定を施す。
  2. ユーザがリソースを作成する際のリージョンを指定する。
  - イニシアチブ
    - ポリシーの集合体。(イニシアチブ定義)
- 以下の範囲にイニシアチブ、ポリシーを適応できる
  1. リソースグループ
  2. サブスクリプション
  3. 管理グループ(複数のサブスクリプションを管理するもの)

### アクセスコントロール(Role Base Acssese Controlle: RBAC)

- 行える操作とユーザの間にロール(グルーピングされた操作)という概念を噛ませることによって権限の付与を行う。
- がらぽんでいうとAdmin, User, Gesstのような考え方。

### ロック

- リソースを削除しないようにする。
- 削除ロック
  - 読取、更新はできる。
- 読取専用ロック
  - 読取のみできる。

### Azure Blueprints

- ポリシーやRBACでは提供できないものを提供する。
- ポリシー、イニシアチブ、RBAC、ARMテンプレート(FW定義など)を同時に設定できる。

### サブスクリプションガバナンス

- リソースにきちんとタグ付けをすることによって部署ごとの請求額を可視化できる。
- サブスクリプションごとの作成可能なリソース数の上限を設定できる。

## Azureでの監視とレポート

### タグ

- 全てのリソースに付与することが可能。付与しないことも可能。
- タグ付けを必須化する場合はポリシーを制定する。
- 誰の持ち物か、責任の所在を明確化できる。

### Azure Monitor

- リソースに対してのセキュリティ以外の要素を収集して管理、集計するもの。
- パフォーマンス、ログ、使用量などを集計して可視化するもの。
- ログ
  - アクティビティログ: アクセス履歴
- メトリック
  - パフォーマンスの管理
- モニター
  - アラート: 特定の動作でアラートを出す設定をすることができる。

### Azure Application Insight

- アプリケーションをモニタリングしレポートを出す。
- 標準開発にする必要がある。

### Azure Service Health

- AzureServiceの正常性をチェックする。

## コンプライアンスの条件

### HIPAA

### ISO

- 国際標準

### NIST

- 米国標準

### GDPR

### プライバシーに対する声明

### トラストセンター

- 日本語訳だとセキュリティセンターを表示されている。

### Service Trust Portal

- コンプライアンスマネージャー
- IT部分ではない会社としてのコンプライアンスの適合率や対策を管理する。

### Azure Government

- 米国連邦政府機関, 州政府および地方自治体のみがアクセスできる。

### Azure China

- Publicなリージョンから隔離されている。

### Azure Germany

- 隔離はされていないが、ドイツの法律に厳格に保護されている。
- Azure Germany内の個人情報を持ち出すことはできない。

## Azure サブスクリプション

- Azureの契約(使用権)
- 部署ごとに課金を明確に分けたい場合などに使用。
- AzureADとの関係は1:1ではない。
- AzureAD : Subscription = 1 : *
- 顧客タイプによって購入の方法、請求方法が変わる。
- リージョンが変わると単価が変わる。

### Azure フリーアカウント

- 1人につき1つ。

-

### Azureのオブジェクト構造

- 会社ごとに大量のサブスクリプションがある。それを一括管理するのが管理グループ。
- 管理グループは階層構造にすることが可能。

### 料金計算ツール

- リソースの条件を設定することで価格を計算することができる。

### TCO計算ツール

- オンプレの全てのリソースを入力するとAzureに移行した場合のコストを算出するツール。

### Azure Cost Management

- コストを分析・管理できる。

### Azureのテクニカルサポート

- Azureサービスとは分離しているため基本的には有償サービスになっている。
- Standard契約すると電話での対応を受けられる。
- Premier契約するとAzure構成についてディスカッションできる。

### 無償サービス

1. MSDN
2. Stack Overfrow
3. Sever Fault

### Knowledge Center

- キーワード検索ができる。

### ヘルプとサポート

- サポートリクエストを送信することができる。

### SLA

- サービスの稼働時間のMicrosoftのコミットメント。
- 年間の最大許容停止時間を越えるとサービスクレジット(Azureの利用料金の割引)が補填される。
- 複合SLAは全てのSLAをかけ合わせる。
- 回復性:
- 可用性: MTTR: 平均故障時間, MTBR: 平均故障感覚

### Azureのライフサイクル

- プレビュー
  - <https://preview.portal.azure.com/でAzurePortal>プレビューにアクセスできる。
  - リソースを選択する際に(プレビュー)が付いているものは仕様版。
- GA
  - 一般公開されるもの。
  - 基本的に有償。

## 勉強会用メモ

- AZ900対策授業とする。

### 勉強会の内容

- どのような内容をしゃべるか？
  - クラウドの概要
    - だいたいうっすら知っていると思う。。。
  - コアサービス
    - 先輩方の方が知見がある。だいたい他クラウドと同じ
  - Azureにおいてのセキュリティ
    - Azureがどのような思想の元セキュリティを担保しているかや、セキュリティ診断に用いられる各種サービスについて。セキュリティ大事。
  - Azureの料金体系
    - Azureサービスの料金がどのような要素で変動するかや、無償有償サポートにどのようなものがあるは知っておいて損は無さそう。

- 導入
- セキュリティ
- 料金体系、サポート
- AZ900
