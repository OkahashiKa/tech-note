# 第2回コンテナ勉強会

## クラスタ構成

### ネットワーク構成

- AKSはVnet上にデプロイされる。
- KubernetesではKubenetとAzureCNIからネットワーク構成を選択できる。
  - kubenet
    - NodeについてはVnetのアドレス空間内のアドレスを持つ。
    - Kubenet: vNetのネットワーク帯とは別のPod用の別のアドレス空間にデプロイされる。
    - kube-proxy: アドレス変換とNATを行っている。
    - vNetとpodでアドレス空間が異なるためPodのアドレスを直でアクセスすることが出来ない。
    - Pod用のアドレス空間を設定せず利用できる。
    - サブネットで利用するアドレス空間を節約できる。
    - NAT(kube-proxy)の適応時に若干オーバーヘッドが発生する。
    - Podへのアクセスするには、別途アクセス用の構成を構築する必要がある。
  - Azure CNI
    - vNetのアドレス空間内のアドレスがPodに割り当てられる。
    - Podに対して直接アクセスすることができる。
    - WindowsOSのNodeや仮想Nodeを使用できる。
    - 通信の可視性が向上する。(kube-proxyが丸めないため)
    - 構築時に（将来的の拡張や運用も含めて）アドレス空間の設計が必要。
- AKSのNodeへのアクセスがL4, L7ロードバランサ―で振り分けられる。
- Pod間アクセス制御はNSGは向かない。
- ポッド単位での通信の制御はネットワークポリシーを定義する。
  - Calico: Tigera社製オープンソースのセキュリティポリシー
    - kubenet, AzureCNIどちらも選択できる。
  - Azure: Azure独自のセキュリティポリシー
    - AzureCNI構成しか選択できない。

### ストレージ構成

- Podで処理したデータは利用したい場合は、Pod外に何らかの形でデータを配置する必要がある。
  - Kubenertesは割と簡単にPodを消すので消されていけないデータはPod外へ。
  - AzureディスクとAzureFilesが外部ストレージとしてマウント可能。

### クラスタ分離のベストプラクティス

- 推奨としてはできるだけ少ないクラスターで運用する。
- デフォルトの名前空間
  - default
    - 空の名前空間
    - ユーザーが自由に利用出来る。
  - kube-system
    - 通常は使用しない。
  - kube-public
    - 通常は使用しない。

## 非機能構成

- NodeとPodのスケーリング
  - Nodeはスケーリングができない。
  - Podはスケールアップ、アウト共にできる。
  - マニフェストによって設定が可能。

- Azure Container Instanceに仮想ノードを作成してAKSから管理できる

  -
